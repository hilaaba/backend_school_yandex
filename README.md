# Описание

Бэкенд для веб-сервиса хранения файлов, аналогичный сервису [Яндекс Диск](https://yandex.ru/disk). Логика взаимодействия:
1. Пользователь загружает и структурирует файлы в предложенном ему облачном пространстве.
2. Пользователь может скачивать файлы и фиксировать историю их изменений.

Разработан REST API сервис, который позволяет пользователям загружать и обновлять информацию о файлах и папках.

Задание можно посмотреть в файле <code>Task.md</code>, а сами запросы и условия по ним в <code>openapi.yaml</code>

# Технологии:
```
Python 3.8  
Django 2.2.19  
Django REST Framework 3.13.1  
Djoser 2.1.0  
PostgreSQL 12  
Docker 20.10.17
Gunicorn 20.1.0  
Nginx 1.19.3
```

# Как запустить проект локально в docker-контейнерах:

```console
git clone https://github.com/hilaaba/backend_school_yandex.git
cd backend_school_yandex/infra
```

Создать <code>.env</code> файл. Шаблон наполнения env-файла:
```
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
```

Запустить приложение в docker-контейнерах:
```
sudo docker-compose up -d --build
```

Выполнить миграции:

```bash
docker-compose exec backend python3 manage.py migrate
```

Теперь проект доступен по адресу <http://127.0.0.1/>

### Базовые задачи

#### /imports 

Импортирует новые файлы и/или папки. Файлы/папки импортированные повторно обновляют текущие. Изменение типа элемента с файла на папку или с папки на файл не допускается. Порядок элементов в запросе является произвольным.

- uuid файла или папки является уникальным среди файлов и папок
- родителем файла или папки может быть только папка
- принадлежность к папке определяется полем parentId
- файл или папка могут не иметь родителя (при обновлении parentId на null, элемент остается без родителя)
- название элемента не может быть null
- у папки поле size должно содержать null
- размер файла не может быть null и должна быть больше либо равна нулю.
- при обновлении файла/папки обновленными считаются **все** их параметры
- при обновлении параметров элемента обязательно обновляется поле **date** в соответствии с временем обновления
- в одном запросе не может быть двух элементов с одинаковым id
- дата должна обрабатываться согласно ISO 8601 (такой придерживается OpenAPI). Если дата не удовлетворяет данному формату, необходимо отвечать 400.

#### /delete

- Удалить элемент по идентификатору.
- При удалении категории, удаляются все дочерние элементы
- Так как время удаления не передается, при удалении элемента время обновления родителя изменять не нужно.

#### /nodes/{id}

- Получить информацию об элементе по идентификатору.
- При получении информации о папке также предоставляется информация о её дочерних элементах.
- Для пустой папки поле children равно пустому массиву, а для файла равно null
- Размер папки - это сумма размеров всех её файлов, включая файлы дочерних папок. Если папка не содержит файлов, то размер равна null. При обновлении размера файла, размер папки, которая содержит этот файл, тоже обновляется.

#### /updates?date=date

- Получение списка **файлов**
- Размер которых был обновлен за последние 24 часа включительно [now() - 24h, now()] от времени переданном в запросе. Обновление размера не означает её изменение. Обновления размеров удаленных файлов недоступны. При обновлении размера файла, размер папки, которая содержит этот файл, тоже обновляется.

#### /node/{id}/history?dateStart=DATE&dateEnd=DATE

- Получение истории **файла**
- **dateStart** - Дата и время начала интервала, для которого считается история. 
- **dateEnd** - Дата и время конца интервала, для которого считается история.
