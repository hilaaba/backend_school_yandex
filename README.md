# Описание

Бэкенд для веб-сервиса хранения файлов, аналогичный сервису [Яндекс Диск](https://yandex.ru/disk). Логика взаимодействия:
1. Пользователь загружает и структурирует файлы в предложенном ему облачном пространстве.
2. Пользователь может скачивать файлы и фиксировать историю их изменений.

Разработан REST API сервис, который позволяет пользователям загружать и обновлять информацию о файлах и папках.

Задание можно посмотреть в файле <code>Task.md</code>, а сами запросы и условия по ним в <code>openapi.yaml</code>

# Технологии:
```
Python 3.8  
Django 2.2.19  
Django REST Framework 3.13.1  
PostgreSQL 12  
Docker 20.10.17
Gunicorn 20.1.0  
Nginx 1.19.3
```

# Как запустить проект локально в docker-контейнерах:

```console
git clone https://github.com/hilaaba/backend_school_yandex.git
cd backend_school_yandex/infra
```

Создать файл <code>.env</code> в папке infra. Шаблон наполнения env-файла:
```
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
SECRET_KEY=KEY
```

Запустить приложение:
```
sudo docker-compose up -d --build
```

Выполнить миграции:
```console
sudo docker-compose exec backend python3 manage.py migrate
```

Собрать статику:
```console
sudo docker-compose exec backend python3 manage.py collectstatic --no-input
```

Создать суперпользователя для админки:
```console
sudo docker-compose exec backend python3 manage.py createsuperuser
```

Теперь проект доступен по адресу <http://127.0.0.1/>

Страница админ панели:  <http://127.0.0.1/admin/>

### Базовые задачи

#### /imports 

Импортирует элементы файловой системы. Элементы импортированные повторно обновляют текущие.
Изменение типа элемента с папки на файл и с файла на папку не допускается.
Порядок элементов в запросе является произвольным.


- id каждого элемента является уникальным среди остальных элементов
- поле id не может быть равно null
- родителем элемента может быть только папка
- принадлежность к папке определяется полем parentId
- элементы могут не иметь родителя (при обновлении parentId на null элемент остается без родителя)
- поле url при импорте папки всегда должно быть равно null
- размер поля url при импорте файла всегда должен быть меньше либо равным 255
- поле size при импорте папки всегда должно быть равно null
- поле size для файлов всегда должно быть больше 0
- при обновлении элемента обновленными считаются **все** их параметры
- при обновлении параметров элемента обязательно обновляется поле **date** в соответствии с временем обновления
- в одном запросе не может быть двух элементов с одинаковым id
- дата обрабатывается согласно ISO 8601 (такой придерживается OpenAPI). Если дата не удовлетворяет данному формату, ответом будет код 400.

#### /delete/{id}

- Удалить элемент по идентификатору.
- При удалении папки, удаляются все дочерние элементы
- Так как время удаления не передается, при удалении элемента время обновления родителя изменять не нужно.

#### /nodes/{id}

- Получить информацию об элементе по идентификатору.
- При получении информации о папке также предоставляется информация о её дочерних элементах.
- Для пустой папки поле children равно пустому массиву, а для файла равно null
- Размер папки - это сумма размеров всех её файлов, включая файлы дочерних папок. Если папка не содержит файлов, то размер равна null. При обновлении размера файла, размер папки, которая содержит этот файл, тоже обновляется.

#### /updates?date=ADD_DATE

- Получение списка **файлов**, которые были обновлены за последние 24 часа включительно [date - 24h, date] от времени переданном в запросе.

#### /node/{id}/history?dateStart=ADD_DATE&dateEnd=ADD_DATE

- Получение истории **элемента**
- **dateStart** - Дата и время начала интервала, для которого считается история. 
- **dateEnd** - Дата и время конца интервала, для которого считается история.
